<%= turbo_stream_from current_user, "dashboard" %>
<%= turbo_stream_from "user_#{current_user.id}_rides" %>
<%= turbo_stream_from current_user.company_profile if current_user.company_profile.present? %>
<% if @company_profile.present? %>
  <%= turbo_stream_from @company_stream_name %>
  <%= turbo_stream_from @company_rides_stream_name %>
  <%= turbo_stream_from @company_drivers_stream_name %>
<% end %>

<div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
  <%# Left Column - Company Profile Information %>
  <div class="lg:col-span-4 space-y-6">
    <%# Profile Section %>
    <%= render "dashboard/user_information", user: current_user %>
  </div>

  <%# Right Column - Company Dashboard Content %>
  <% if current_user.company_profile.present? %>
    <div class="lg:col-span-8 space-y-6">
    <%= turbo_frame_tag "stats_cards", src: update_stats_path(format: :turbo_stream) do %>
      <%# Top section with statistics cards %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <%= turbo_frame_tag "financial_summary" %>
        <%= turbo_frame_tag "ride_statistics" %>
        <%= turbo_frame_tag "drivers_card" %>
        <%= turbo_frame_tag "performance_card" %>
      </div>

      <div class="flex justify-end mt-2">
        <%= link_to "Reports", reports_path, class: "inline-block bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded shadow transition duration-150 ease-in-out" %>
      </div>

      <%# Driver Performance Section %>
      <div class="bg-white rounded-lg shadow">
        <div class="px-4 py-5 border-b border-gray-200 sm:px-6">
          <h3 class="text-lg leading-6 font-medium text-gray-900">Driver Performance</h3>
          <p class="mt-1 max-w-2xl text-sm text-gray-500">Compare performance metrics across your drivers.</p>
        </div>
        <div class="p-4">
          <%= turbo_frame_tag "company_drivers" %>
        </div>
      </div>

      <%# Recent Activity / Ride Status %>
      <%= turbo_frame_tag "company_recent_rides" %>

      <%# Completed and Cancelled Rides %>
      <div class="space-y-6">
        <%# Completed Rides %>
        <%= turbo_frame_tag "company_completed_rides" %>

        <%# Cancelled Rides %>
        <%= turbo_frame_tag "company_cancelled_rides" %>
      </div>
      <% end %>
    </div>
  <% else %>
    <%# Company profile creation prompt %>
    <div class="lg:col-span-8 space-y-6 bg-white rounded-lg shadow p-6 text-center">
      <h2 class="text-2xl font-bold mb-4">Create Your Company Profile</h2>
      <p class="mb-6">You need to create a company profile to view the dashboard and manage drivers.</p>
      <div class="flex flex-wrap justify-center gap-y-4 space-x-4">
        <%= link_to new_company_profile_path, 
            class: "bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded transition duration-150 ease-in-out" do %>
          Create Company Profile
        <% end %>
        
        <%= button_to toggle_role_path(role: 'passenger'), 
            method: :patch,
            class: "bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded border border-gray-300 transition duration-150 ease-in-out btn-loader btn-loader-dark",
            data: { controller: "button-loader" } do %>
          Return to Passenger
        <% end %>
        
        <%= button_to toggle_role_path(role: 'driver'), 
            method: :patch,
            class: "bg-gray-100 hover:bg-gray-200 text-gray-800 font-semibold py-2 px-6 rounded border border-gray-300 transition duration-150 ease-in-out btn-loader btn-loader-dark",
            data: { controller: "button-loader" } do %>
          Return to Driver
        <% end %>
      </div>
    </div>
  <% end %>
</div>
