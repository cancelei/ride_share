<div class="container mx-auto px-4 py-8">
  <div class="max-w-3xl mx-auto">
    <div class="bg-white rounded-lg shadow-sm p-6 md:p-8">
        <h1>Edit User</h1>

        <%= form_with(model: @user, url: user_path(@user), local: true, method: :patch, html: { method: :patch, class: "space-y-4", data: { turbo: true } }) do |f| %>
            <div class="flex flex-col space-y-6 md:flex-row md:space-y-0 md:space-x-6">
                <div class="w-full md:w-1/3">
                    <div class="flex flex-col items-center p-6 bg-white rounded-lg shadow" data-controller="avatar-preview">
                        <div data-avatar-preview-target="preview">
                        <%= render 'shared/avatar', user: @user, size: :large, class: "mb-4" %>
                        </div>
                        
                        <div class="w-full">
                        <%= f.label :avatar, class: "block text-sm font-medium text-gray-700 mb-1" %>
                        <%= f.file_field :avatar, 
                                        direct_upload: true, 
                                        accept: "image/png,image/jpeg,image/jpg", 
                                        class: "block w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none",
                                        data: { avatar_preview_target: "input" } %>
                        <p class="mt-1 text-xs text-gray-500">PNG, JPG or JPEG (max. 5MB)</p>
                        </div>
                    </div>
                </div>

                <div class="w-full md:w-2/3 space-y-4">
                    <div class="field">
                        <%= f.label :first_name, class: "block text-sm font-medium text-gray-700" %>
                        <%= f.text_field :first_name, autofocus: true, autocomplete: "first-name", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
                    </div>

                    <div class="field">
                        <%= f.label :last_name, class: "block text-sm font-medium text-gray-700" %>
                        <%= f.text_field :last_name, autocomplete: "last-name", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
                    </div>

                    <div class="field">
                        <%= f.label :phone_number, class: "block text-sm font-medium text-gray-700" %>
                        <%= f.telephone_field :phone_number,
                                id: "phone_input",
                                autocomplete: "tel",
                                class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 placeholder-gray-400" %>
                    </div>

                    <div class="field">
                        <%= f.label :country, class: "block text-sm font-medium text-gray-700" %>
                        <%= f.select :country, country_options, { include_blank: "Select Country" },
                                id: "country_select",
                                class: "mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm text-gray-900 bg-white" %>
                    </div>

                    <div class="field">
                        <%= f.label :email, class: "block text-sm font-medium text-gray-700" %>
                        <%= f.email_field :email, autocomplete: "email", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
                    </div>

                    <div class="field">
                        <%= f.label :password, class: "block text-sm font-medium text-gray-700" %>
                        <div class="text-xs text-gray-500 mb-1">(leave blank if you don't want to change it)</div>
                        <%= f.password_field :password, autocomplete: "new-password", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
                    </div>

                    <div class="flex justify-between items-center pt-5">
                        <div class="actions">
                            <%= f.submit "Update", class: "py-2 px-4 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-75 transition-colors" %>
                        </div>
                        <%= link_to "Back", :back, class: "text-gray-600 hover:text-indigo-600" %>
                    </div>
                </div>
            </div>
            <%= f.hidden_field :timezone, id: 'timezone-field' %>

            <script>
                document.addEventListener('turbo:load', function() {
                const timezoneField = document.getElementById('timezone-field');
                timezoneField.value = Intl.DateTimeFormat().resolvedOptions().timeZone;
                });
            </script>
        <% end %>

        <%= link_to 'Back', users_path %>
    </div>
  </div>
</div>